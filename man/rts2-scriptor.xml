<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE refentry PUBLIC "-//OASIS//DTD DocBook XML V4.2//EN"
"http://www.oasis-open.org/docbook/xml/4.2/docbookx.dtd" [

  <!ENTITY dhfirstname "<firstname>Petr</firstname>">
  <!ENTITY dhsurname   "<surname>Kubanek</surname>">
  <!ENTITY dhdate      "<date>2014-10-17</date>">
  <!ENTITY dhsection   "<manvolnum>1</manvolnum>">
  <!ENTITY dhemail     "<email>petr@kubanek.net</email>">
  <!ENTITY dhusername  "Petr Kubanek">
  <!ENTITY dhpackage   "rts2-scriptor">

  <!ENTITY % rts2 SYSTEM "rts2.ent">
  %rts2;
]>

<refentry>
  <refentryinfo>
    <title>&dhpackage;</title>
    <productname>rts2</productname>
    <productnumber>&rts2version;</productnumber>
    &dhdate;
    <authorgroup>
      <author>
        &dhfirstname;
        &dhsurname;
	<contrib>Wrote most of the RTS2 package.</contrib>
	<address>
          &dhemail;
	</address>
      </author>
    </authorgroup>
    <copyright>
      <year>2007 - 2014</year>
      <holder>&dhusername;</holder>
    </copyright>
    &legal;
  </refentryinfo>
  <refmeta>
    <refentrytitle>&dhpackage;</refentrytitle>
    &dhsection;
  </refmeta>
  <refnamediv>
    <refname>&dhpackage;</refname>
    <refpurpose>Daemon which executes script on devices.</refpurpose>
  </refnamediv>
  <refsynopsisdiv>
    <cmdsynopsis>
      <command>&dhpackage;</command>
      &deviceapp;
      <arg choice="opt">
	<arg choice="plain"><option>--config <replaceable>config file</replaceable></option></arg>
      </arg>
      <arg choice="opt">
        <arg choice="plain"><option>--expand-path <replaceable>expand string</replaceable></option></arg>
      </arg>
    </cmdsynopsis>
  </refsynopsisdiv>

  <refsect1 id="description">
    <title>DESCRIPTION</title>

    <para>
      <command>&dhpackage;</command> enables execution of scripts on devices.
      It is different from
      <citerefentry><refentrytitle>rts2-scriptexec</refentrytitle><manvolnum>1</manvolnum></citerefentry>
      that it runs as daemon. Scripts can be generated by execution programs
      with parameters.
    </para>

  </refsect1>
  <refsect1 id="options">
    <title>OPTIONS</title>

    &optiongnu;

    <variablelist>
      &deviceapplist;
      <varlistentry>
        <term><option>--expand-path <replaceable class="parameter">expand string</replaceable></option></term>
        <listitem>
          <para>
            Specify path for files created by script executor. Path can contain expansion sequences, as described in <citerefentry><refentrytitle>rts2</refentrytitle><manvolnum>7</manvolnum></citerefentry>.
	  </para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term><option>--script-gen <replaceable class="parameter">path</replaceable></option></term>
        <listitem>
          <para>
	    Path to script generator. Script generator writes to standard
            output commands which will be executed by scriptor. The command receives as the
            first parameter current state of the RTS2 system.
          </para>
        </listitem>
      </varlistentry>
    </variablelist>
  </refsect1>
  <refsect1>
    <title>THEORY OF OPERATION</title>
    <para>
       Scriptor read script to execute from script passed with the
       <option>--script-get</option> option. It executes the file, and reads
       its standard output for commands. The commands are described in
       <citerefentry><refentrytitle>rts2.script</refentrytitle><manvolnum>5</manvolnum></citerefentry>.
    </para>
    <refsect2>
       <title>SCRIPT ARGUMENT</title>
       <para>
         <variablelist>
           <varlistentry>
             <term>0</term>
             <listitem><para>day</para></listitem>
           </varlistentry>
           <varlistentry>
             <term>1</term>
             <listitem><para>evening</para></listitem>
           </varlistentry>
           <varlistentry>
             <term>2</term>
             <listitem><para>dusk</para></listitem>
           </varlistentry>
           <varlistentry>
             <term>3</term>
             <listitem><para>night</para></listitem>
           </varlistentry>
           <varlistentry>
             <term>4</term>
             <listitem><para>dawn</para></listitem>
           </varlistentry>
           <varlistentry>
             <term>5</term>
             <listitem><para>morning</para></listitem>
           </varlistentry>
         </variablelist>
       </para>
    </refsect2>
  </refsect1>
  <refsect1>
    <title>EXAMPLE SCRIPT</title>
    <para>
       This script reads the first argument, and depending on its value, either
       took 36 second dark frame, sequence of 1 second flat frames, or 36 second
       science frames.
    </para>
    <literallayout>
#!/bin/bash
 
case "$1" in
        [1,5])
                echo "D 36"
                ;;
        [2,4])
                echo "E 1 E 1 E 1"
                ;;
        3)
                echo "E 36"
                ;;
        *)
                echo "sleep 30"
                ;;
esac
    </literallayout>
  </refsect1>
  <refsect1>
    <title>SEE ALSO</title>

    <para>
      <citerefentry>
        <refentrytitle>rts2</refentrytitle>
	<manvolnum>7</manvolnum>
      </citerefentry>
      <citerefentry>
        <refentrytitle>rts2.script</refentrytitle>
	<manvolnum>5</manvolnum>
      </citerefentry>
      <citerefentry>
        <refentrytitle>rts2.ini</refentrytitle>
	<manvolnum>5</manvolnum>
      </citerefentry>
      <citerefentry>
        <refentrytitle>rts2-scriptexec</refentrytitle>
	<manvolnum>1</manvolnum>
      </citerefentry>
    </para>

  </refsect1>
</refentry>
